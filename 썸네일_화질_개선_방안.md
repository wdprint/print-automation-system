# 썸네일 화질 개선 방안

## 현재 문제점
PDF에 썸네일 이미지를 삽입할 때 화질 열화가 심각하게 발생하고 있습니다.

## 개선 방안

### 1. 이미지 리샘플링 알고리즘 개선
현재 `LANCZOS` 알고리즘을 사용 중이지만, 다음과 같은 개선이 가능합니다:

```python
# core/image_handler.py - 61번 줄 수정
# 기존
img.thumbnail(size, Image.Resampling.LANCZOS)

# 개선안 - BICUBIC 사용 (더 부드러운 결과)
img.thumbnail(size, Image.Resampling.BICUBIC)
```

### 2. PDF 삽입 시 압축 방지
PDF에 이미지를 삽입할 때 압축을 최소화:

```python
# core/pdf_processor.py에서 이미지 삽입 부분 수정
# fitz를 사용한 이미지 삽입 시 압축 옵션 조정
page.insert_image(
    rect,
    pixmap=img_pixmap,
    keep_proportion=True,
    overlay=True,
    compress=False  # 압축 비활성화
)
```

### 3. 이미지 전처리 품질 향상
썸네일 생성 전 원본 이미지 품질 개선:

```python
def enhance_image_quality(self, image: Image.Image) -> Image.Image:
    """이미지 품질 향상"""
    # 1. 선명도 향상
    sharpness = ImageEnhance.Sharpness(image)
    image = sharpness.enhance(1.2)  # 20% 선명도 증가
    
    # 2. 대비 향상
    contrast = ImageEnhance.Contrast(image)
    image = contrast.enhance(1.1)  # 10% 대비 증가
    
    # 3. 언샵 마스크 적용 (고급 선명화)
    image = image.filter(ImageFilter.UnsharpMask(
        radius=2,
        percent=150,
        threshold=3
    ))
    
    return image
```

### 4. 해상도 설정 최적화
DPI 설정을 통한 품질 향상:

```python
# 썸네일 생성 시 DPI 보존
def create_thumbnail_high_quality(self, image_path: str, size: Tuple[int, int]):
    with Image.open(image_path) as img:
        # DPI 정보 보존
        dpi = img.info.get('dpi', (300, 300))
        
        # 고품질 리샘플링
        img = img.resize(size, Image.Resampling.LANCZOS)
        
        # DPI 정보 유지
        img.info['dpi'] = dpi
        
        return img
```

### 5. PDF 렌더링 해상도 증가
PDF를 이미지로 변환할 때 해상도 증가:

```python
# PDF 페이지를 고해상도로 렌더링
pixmap = page.get_pixmap(
    matrix=fitz.Matrix(2, 2),  # 2배 확대
    dpi=300,  # 300 DPI
    alpha=False
)
```

### 6. 이미지 포맷 최적화
PNG 대신 손실 없는 형식 사용:

```python
# 이미지 저장 시 품질 설정
image.save(
    output_path,
    format='PNG',
    optimize=False,  # 최적화 비활성화로 품질 유지
    compress_level=0  # 압축 최소화
)
```

## 권장 구현 순서

1. **즉시 적용 가능** (코드 수정 최소)
   - PDF 삽입 시 compress=False 옵션 추가
   - 이미지 저장 시 quality=100 설정

2. **단기 개선** (약간의 코드 수정)
   - 선명도/대비 향상 함수 추가
   - DPI 정보 보존

3. **장기 개선** (구조적 변경)
   - 벡터 그래픽 지원 (SVG)
   - 이미지 캐싱 최적화
   - 병렬 처리로 성능 향상

## 테스트 방법

1. 동일한 이미지로 품질 비교
2. 파일 크기 vs 품질 트레이드오프 측정
3. 처리 시간 벤치마크

## 주의사항

- 품질을 높이면 파일 크기가 증가합니다
- 처리 시간이 늘어날 수 있습니다
- 메모리 사용량이 증가할 수 있습니다

이러한 방안들을 순차적으로 적용하여 최적의 품질/성능 균형점을 찾는 것이 중요합니다.